<ng-container *ngIf="!cargandoOferta && oferta; else cargandoTpl">

  <!-- â”€â”€â”€ HERO SUPERIOR (idÃ©ntico a jobdetail, con edit/volver) â”€â”€â”€ -->
  <section class="detail-hero">
    <div class="detail-hero__contenido">
      <!-- IZQUIERDA: TÃ­tulo, subtÃ­tulo e Ã­cono de tipo de jornada -->
      <div class="detail-hero__izq">
        <h1 class="detail-hero__title">
          {{ isEditing ? 'âœï¸ Editando Oferta' : oferta.titulo }}
        </h1>
        <p class="detail-hero__subtitle">
          ğŸ¢ {{ oferta.empresa }} &nbsp;â€¢&nbsp; ğŸŒ {{ oferta.ubicacion }}
        </p>
        <span class="detail-hero__badge">
          ğŸ“‘ {{ oferta.tipo.replace('_',' ') }}
        </span>
      </div>

      <!-- DERECHA: Botones "Editar", "Cancelar", "Guardar", "Volver" -->
      <div class="detail-hero__acciones">
        <button *ngIf="!isEditing" class="btn btn-editar" (click)="toggleEditMode()">
          âœï¸ Editar
        </button>
        <button *ngIf="isEditing" class="btn btn-cancelar" (click)="toggleEditMode()" [disabled]="loadingGuardar">
          â†©ï¸ Cancelar
        </button>
        <button *ngIf="isEditing" class="btn btn-guardar" (click)="guardarCambios()" [disabled]="loadingGuardar">
          {{ loadingGuardar ? 'Guardandoâ€¦' : 'ğŸ’¾ Guardar' }}
        </button>
        <button class="btn btn-volver" (click)="volverAMisOfertas()">
          â† Volver
        </button>
      </div>
    </div>

    <!-- Mensaje de error si falla algo al guardar -->
    <div *ngIf="errorGuardar" class="error-message-toast">
      {{ errorGuardar }}
    </div>
  </section>


  <!-- â”€â”€â”€ CONTENEDOR GENERAL: DETALLE DE LA OFERTA + SIDEBAR POSTULANTES â”€â”€â”€ -->
  <div class="container-detalle-oferta">

    <!-- â”€â”€â”€ ZONA PRINCIPAL: Detalle de oferta (lectura / ediciÃ³n) â”€â”€â”€ -->
    <main class="detalle-oferta__main">

      <!-- BLOQUE â€œDescripciÃ³nâ€ y FORMULARIO EN MODO EDICIÃ“N -->
      <div class="detail-content">
        <h2>ğŸ“ DescripciÃ³n</h2>

        <!-- MODO LECTURA: solo muestro el texto de la descripciÃ³n -->
        <ng-container *ngIf="!isEditing; else editFormTpl">
          <p>{{ oferta.descripcion }}</p>
        </ng-container>

        <!-- MODO EDICIÃ“N: formulario completo -->
        <ng-template #editFormTpl>
          <form class="edit-form">

            <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
            <!-- â•‘  FORMULARIO ORGANIZADO EN CAJAS: cada â€œform-groupâ€ es un campo â•‘ -->
            <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

            <!-- â”€â”€ TÃTULO â”€â”€ -->
            <div class="form-group">
              <label for="titulo">âœï¸ TÃ­tulo</label>
              <input
                id="titulo"
                type="text"
                [(ngModel)]="editPayload.titulo"
                name="titulo"
                class="form-control"
              />
            </div>

            <!-- â”€â”€ EMPRESA â”€â”€ -->
            <div class="form-group">
              <label for="empresa">ğŸ¢ Empresa</label>
              <input
                id="empresa"
                type="text"
                [(ngModel)]="editPayload.empresa"
                name="empresa"
                class="form-control"
              />
            </div>

            <!-- â”€â”€ UBICACIÃ“N â”€â”€ -->
            <div class="form-group">
              <label for="ubicacion">ğŸ“ UbicaciÃ³n</label>
              <input
                id="ubicacion"
                type="text"
                [(ngModel)]="editPayload.ubicacion"
                name="ubicacion"
                class="form-control"
              />
            </div>

            <!-- â”€â”€ TIPO DE JORNADA â”€â”€ -->
            <div class="form-group">
              <label for="tipo">ğŸ“‘ Tipo de jornada</label>
              <select
                id="tipo"
                [(ngModel)]="editPayload.tipo"
                name="tipo"
                class="form-control"
              >
                <option value="Full_Time">Full Time</option>
                <option value="Part_Time">Part Time</option>
                <option value="Freelance">Freelance</option>
              </select>
            </div>

            <!-- â”€â”€ SUELDO â”€â”€ -->
            <div class="form-group">
              <label for="sueldo">ğŸ’° Sueldo</label>
              <input
                id="sueldo"
                type="number"
                [(ngModel)]="editPayload.sueldo"
                name="sueldo"
                class="form-control"
              />
            </div>

            <!-- â”€â”€ FECHA LÃMITE POSTULACIONES â”€â”€ -->
            <div class="form-group">
              <label for="fechaLimitePostulacion">â³ Fecha lÃ­mite</label>
              <input
                id="fechaLimitePostulacion"
                type="date"
                [(ngModel)]="editPayload.fechaLimitePostulacion"
                name="fechaLimitePostulacion"
                class="form-control"
              />
            </div>

            <!-- â”€â”€ NIVEL DE EXPERIENCIA â”€â”€ -->
            <div class="form-group">
              <label for="nivelExperiencia">ğŸ“ Nivel experiencia</label>
              <input
                id="nivelExperiencia"
                type="text"
                [(ngModel)]="editPayload.nivelExperiencia"
                name="nivelExperiencia"
                class="form-control"
                placeholder="e.g. Junior, Senior"
              />
            </div>

            <!-- â”€â”€ CATEGORÃA â”€â”€ -->
            <div class="form-group">
              <label for="categoria">ğŸ· CategorÃ­a</label>
              <input
                id="categoria"
                type="text"
                [(ngModel)]="editPayload.categoria"
                name="categoria"
                class="form-control"
                placeholder="e.g. TI, Marketing"
              />
            </div>

            <!-- â”€â”€ DEPARTAMENTO â”€â”€ -->
            <div class="form-group">
              <label for="departamento">ğŸ“Œ Departamento</label>
              <input
                id="departamento"
                type="text"
                [(ngModel)]="editPayload.departamento"
                name="departamento"
                class="form-control"
                placeholder="e.g. Desarrollo TI"
              />
            </div>

            <!-- â”€â”€ VACANTES â”€â”€ -->
            <div class="form-group">
              <label for="vacantes">ğŸ‘¥ Vacantes</label>
              <input
                id="vacantes"
                type="number"
                [(ngModel)]="editPayload.vacantes"
                name="vacantes"
                class="form-control"
                min="1"
              />
            </div>

            <!-- â”€â”€ REMOTO â”€â”€ -->
            <div class="form-group">
              <label class="inline-checkbox">
                <input
                  type="checkbox"
                  [(ngModel)]="editPayload.remoto"
                  name="remoto"
                /> ğŸŒ Remoto
              </label>
            </div>

            <!-- â”€â”€ DURACIÃ“N DE CONTRATO â”€â”€ -->
            <div class="form-group">
              <label for="duracionContrato">â± DuraciÃ³n</label>
              <input
                id="duracionContrato"
                type="text"
                [(ngModel)]="editPayload.duracionContrato"
                name="duracionContrato"
                class="form-control"
                placeholder="e.g. 3 meses a prueba"
              />
            </div>

            <!-- â”€â”€ DESCRIPCIÃ“N COMPLETA (textarea grande) â”€â”€ -->
            <div class="form-group form-group--wide">
              <label for="descripcion">âœï¸ DescripciÃ³n completa</label>
              <textarea
                id="descripcion"
                rows="4"
                [(ngModel)]="editPayload.descripcion"
                name="descripcion"
                class="form-control"
              ></textarea>
            </div>

            <!-- â”€â”€ REQUISITOS (textarea) â”€â”€ -->
            <div class="form-group form-group--wide">
              <label for="requisitos">ğŸ“ Requisitos</label>
              <textarea
                id="requisitos"
                rows="3"
                [(ngModel)]="editPayload.requisitos"
                name="requisitos"
                class="form-control"
              ></textarea>
            </div>

            <!-- â”€â”€ HABILIDADES REQUERIDAS (textarea) â”€â”€ -->
            <div class="form-group form-group--wide">
              <label for="habilidadesRequeridas">ğŸ›  Habilidades</label>
              <textarea
                id="habilidadesRequeridas"
                rows="3"
                [(ngModel)]="editPayload.habilidadesRequeridas"
                name="habilidadesRequeridas"
                class="form-control"
              ></textarea>
            </div>

            <!-- â”€â”€ BENEFICIOS (textarea) â”€â”€ -->
            <div class="form-group form-group--wide">
              <label for="beneficios">ğŸ Beneficios</label>
              <textarea
                id="beneficios"
                rows="3"
                [(ngModel)]="editPayload.beneficios"
                name="beneficios"
                class="form-control"
              ></textarea>
            </div>

            <!-- â”€â”€ IDIOMAS (textarea) â”€â”€ -->
            <div class="form-group form-group--wide">
              <label for="idiomas">ğŸ—£ Idiomas</label>
              <textarea
                id="idiomas"
                rows="2"
                [(ngModel)]="editPayload.idiomas"
                name="idiomas"
                class="form-control"
              ></textarea>
            </div>

            <!-- â”€â”€ SITIO WEB DE LA EMPRESA â”€â”€ -->
            <div class="form-group">
              <label for="companyWebsite">ğŸ”— Sitio web</label>
              <input
                id="companyWebsite"
                type="text"
                [(ngModel)]="editPayload.companyWebsite"
                name="companyWebsite"
                class="form-control"
                placeholder="https://ejemplo.com"
              />
            </div>

            <!-- â”€â”€ ETIQUETAS (tags separadas por coma) â”€â”€ -->
            <div class="form-group">
              <label for="etiquetas">ğŸ· Etiquetas</label>
              <input
                id="etiquetas"
                type="text"
                [(ngModel)]="editPayload.etiquetas"
                name="etiquetas"
                class="form-control"
                placeholder="e.g. Java,Angular,Spring"
              />
            </div>
            <!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— -->
            <!-- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
          </form>
        </ng-template>
      </div>

      <!-- â”€â”€â”€ GRID DE METADATOS (modo lectura) â”€â”€â”€ -->
      <div class="detail-meta">
        <div>
          <strong>ğŸ’° Sueldo:</strong><br>
          ${{ oferta.sueldo | number }}
        </div>
        <div>
          <strong>ğŸ“… Publicado:</strong><br>
          {{ oferta.fechaPublicacion | date:'longDate' }}
        </div>
        <div *ngIf="oferta.fechaLimitePostulacion">
          <strong>â³ Fecha lÃ­mite:</strong><br>
          {{ oferta.fechaLimitePostulacion | date:'longDate' }}
        </div>
        <div *ngIf="oferta.nivelExperiencia">
          <strong>ğŸ“ Experiencia:</strong><br>
          {{ oferta.nivelExperiencia }}
        </div>
        <div *ngIf="oferta.categoria">
          <strong>ğŸ· CategorÃ­a:</strong><br>
          {{ oferta.categoria }}
        </div>
        <div *ngIf="oferta.departamento">
          <strong>ğŸ“Œ Departamento:</strong><br>
          {{ oferta.departamento }}
        </div>
        <div *ngIf="oferta.vacantes !== undefined">
          <strong>ğŸ‘¥ Vacantes:</strong><br>
          {{ oferta.vacantes }}
        </div>
        <div *ngIf="oferta.remoto !== undefined">
          <strong>ğŸŒ Remoto:</strong><br>
          {{ oferta.remoto ? 'SÃ­' : 'No' }}
        </div>
        <div *ngIf="oferta.duracionContrato">
          <strong>â± DuraciÃ³n:</strong><br>
          {{ oferta.duracionContrato }}
        </div>
      </div>
    </main>

    <!-- â”€â”€â”€ SIDEBAR: Listado de Postulantes â”€â”€â”€ -->
    <aside class="detalle-oferta__sidebar">
      <h3>ğŸ‘¥ Postulantes ({{ postulantes.length }})</h3>

      <div *ngIf="cargandoPostulantes" class="sidebar-loading">
        Cargando postulantesâ€¦
      </div>
      <div *ngIf="errorPostulantes" class="error-message-toast">
        {{ errorPostulantes }}
      </div>

      <div *ngIf="!cargandoPostulantes && postulantes.length === 0" class="no-postulantes">
        No hay postulantes aÃºn.
      </div>

      <div
        *ngFor="let p of postulantes"
        class="postulante-card"
        (click)="verPerfilPostulante(p.usuarioId)"
      >
        <div class="postulante-card__foto">
          <img
            [src]="p.fotoUrl || '/assets/images/default-avatar.png'"
            alt="Foto {{ p.nombreUsuario }}"
          />
        </div>
        <div class="postulante-card__info">
          <p class="postulante-card__nombre">ğŸ‘¤ {{ p.nombreUsuario }}</p>
          <p class="postulante-card__titulo">ğŸ“ {{ p.tituloProfesional }}</p>
          <p *ngIf="p.presentacion" class="postulante-card__presentacion">
            â€œ{{ p.presentacion | slice:0:40 }}â€¦â€
          </p>
        </div>
        <div class="postulante-card__actions">
          <button class="btn btn-icon" title="Ver perfil">ğŸ”</button>
        </div>
      </div>
    </aside>

  </div>
</ng-container>

<ng-template #cargandoTpl>
  <div class="loading-container">
    <p>Cargando oferta y postulantesâ€¦</p>
  </div>
</ng-template>
